<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Order Form</title>
<style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f8f9fa; }
    h1 { color: #007BFF; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #e9ecef; }
    button { padding: 8px 12px; margin-top: 10px; background: #007BFF; color: white; border: none; cursor: pointer; }
    button:hover { background: #0056b3; }
    .total { font-weight: bold; }
    .radio-group { margin: 10px 0; }
</style>
</head>
<body>

<h1>Order Form</h1>

<form id="orderForm">
    <label>Order Number: <input type="text" id="orderNumber" name="orderNumber" readonly></label><br><br>
    <label>Date: <input type="date" name="date" required></label><br><br>
    <label>Customer Name: <input type="text" name="customerName" required></label><br><br>
    <label>Customer Location: <input type="text" name="customerLocation" required></label><br><br>

    <table id="itemsTable">
        <thead>
            <tr>
                <th>Product</th>
                <th>Quantity</th>
                <th>Unit Price</th>
                <th>Total</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><input type="text" name="product[]" required></td>
                <td><input type="number" name="quantity[]" min="1" value="1" required></td>
                <td><input type="number" name="unitPrice[]" step="0.01" value="0" required></td>
                <td class="rowTotal">0.00</td>
                <td><button type="button" onclick="removeRow(this)">X</button></td>
            </tr>
        </tbody>
    </table>

    <button type="button" onclick="addRow()">Add More</button>

    <p class="total">Grand Total: <span id="grandTotal">0.00</span></p>

    <div class="radio-group">
        <label><input type="radio" name="paymentStatus" value="Received" checked> Payment Received</label>
        <label><input type="radio" name="paymentStatus" value="Pending"> Payment Pending</label>
    </div>

    <label>Amount Paid: <input type="number" name="amountPaid" step="0.01" value="0"></label><br><br>

    <button type="submit">Submit Order</button>
</form>

<script>
function generateOrderNumber() {
    const now = new Date();
    const dd = String(now.getDate()).padStart(2, '0');
    const mm = String(now.getMonth() + 1).padStart(2, '0');
    const yy = String(now.getFullYear()).slice(-2);
    const timestamp = now.getTime();
    return `${dd}${mm}${yy}${timestamp}`;
}

document.getElementById("orderNumber").value = generateOrderNumber();

function addRow() {
    const table = document.getElementById("itemsTable").getElementsByTagName('tbody')[0];
    const row = table.insertRow();
    row.innerHTML = `
        <td><input type="text" name="product[]" required></td>
        <td><input type="number" name="quantity[]" min="1" value="1" required></td>
        <td><input type="number" name="unitPrice[]" step="0.01" value="0" required></td>
        <td class="rowTotal">0.00</td>
        <td><button type="button" onclick="removeRow(this)">X</button></td>
    `;
}

function removeRow(button) {
    const row = button.closest("tr");
    row.remove();
    updateTotals();
}

function updateTotals() {
    let grandTotal = 0;
    const rows = document.querySelectorAll("#itemsTable tbody tr");
    rows.forEach(row => {
        const qty = parseFloat(row.querySelector('input[name="quantity[]"]').value) || 0;
        const price = parseFloat(row.querySelector('input[name="unitPrice[]"]').value) || 0;
        const total = qty * price;
        row.querySelector(".rowTotal").textContent = total.toFixed(2);
        grandTotal += total;
    });
    document.getElementById("grandTotal").textContent = grandTotal.toFixed(2);
}

document.addEventListener("input", function(e) {
    if (e.target.name === "quantity[]" || e.target.name === "unitPrice[]") {
        updateTotals();
    }
});

document.getElementById("orderForm").addEventListener("submit", function(e) {
    e.preventDefault();
    const formData = new FormData(this);
    fetch("https://script.google.com/macros/s/AKfycbwGIyoVWGgVutdNFgAqSJ88QAJoKlLgx4BUROYx5OAbgS5iGt1PDPJ3Ras5INOw835Ufw/exec", { method: "POST", body: formData })
        .then(res => alert("Order submitted successfully!"))
        .catch(err => alert("Error submitting order"));
});
</script>

</body>
</html>
